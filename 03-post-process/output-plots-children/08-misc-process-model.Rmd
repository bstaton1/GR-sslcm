---
editor_options: 
  chunk_output_type: console
---

# Miscellaneous Process Model Components {.tabset .tabset-pills}

## Migratory Strategy Apportionment

```{r pi-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  plot_tseries(est = post_summ(post, sub_index("^pi[year,LH_type,pop]$", year = ts_yrs, LH_type = i_fall, pop = j)),
               label_text = pops[j], yrs = all_yrs[ts_yrs])
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Proportion of Parr with Fall Migration Strategy")
```

## Ocean Survival {.tabset .tabset-pills}

### Yr1 {.tabset .tabset-pills}

#### NOR {.tabset .tabset-pills}

##### Realized Alone

The `r colorize("realized time series", main_cols["model"])`.

```{r phi-O0-O1-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O0_O1[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = c(0, 0.4))
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr1 Ocean Survival (NOR)")
```

##### Realized & [Expected + AR(1)]

The `r colorize("realized time series", main_cols["model"])` and the `r colorize("expected time series including the carry-over residual", main_cols["model2"])`.

```{r phi-O0-O1-plots2, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O0_O1[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  plot_tseries(post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = c(0, 0.4))
  
  keep = sub_index("^phi_O0_O1_dot2[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  add_tseries(post_summ(post, keep), yrs = all_yrs[ts_yrs])
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr1 Ocean Survival (NOR)")
```

#### HOR {.tabset .tabset-pills}

##### Realized Alone

The `r colorize("realized time series", main_cols["model"])`.

```{r phi-O0-O1-hor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O0_O1[year,origin,pop]", year = ts_yrs, origin = o_hor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = c(0, 0.4))
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr1 Ocean Survival (HOR)")
```

### Yr2 {.tabset .tabset-pills}

#### NOR

```{r phi-O1-O2-nor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O1_O2[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = ylim_01)
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr2 Ocean Survival (NOR)")
```

#### HOR

```{r phi-O1-O2-hor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O1_O2[year,origin,pop]", year = ts_yrs, origin = o_hor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = ylim_01)
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr2 Ocean Survival (HOR)")
```

### Yr3 {.tabset .tabset-pills}

#### NOR

```{r phi-O2-O3-nor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O2_O3[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = ylim_01)
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr3 Ocean Survival (NOR)")
```

#### HOR

```{r phi-O2-O3-hor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^phi_O2_O3[year,origin,pop]", year = ts_yrs, origin = o_hor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = ylim_01)
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Yr3 Ocean Survival (HOR)")
```

## Maturity {.tabset .tabset-pills}

### Pr(Age-3) {.tabset .tabset-pills}

#### NOR

```{r psi-O1-nor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^psi_O1[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = c(0, 0.4))
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Pr(Mature Age-3|NOR)")
```

#### HOR

```{r psi-O1-hor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^psi_O1[year,origin,pop]", year = ts_yrs, origin = o_hor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = c(0, 0.4))
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Pr(Mature Age-3|HOR)")
```

### Pr(Age-4) {.tabset .tabset-pills}

#### NOR

```{r psi-O2-nor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^psi_O2[year,origin,pop]", year = ts_yrs, origin = o_nor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = ylim_01)
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Pr(Mature Age-4|NOR)")
```

#### HOR

```{r psi-O2-hor-plots, fig.width = p4_width, fig.height = p4_height}
plot_f = function(j) {
  keep = sub_index("^psi_O2[year,origin,pop]", year = ts_yrs, origin = o_hor, pop = j)
  plot_tseries(est = post_summ(post, keep), yrs = all_yrs[ts_yrs], label_text = pops[j], ylim = ylim_01)
}

mypar()
junk = sapply(1:jags_data$nj, plot_f)
axis_labels("Brood Year", "Pr(Mature Age-4|HOR)")
```

## Straying Dynamics {.tabset .tabset-pills}

### Number of Strays

```{r n-stray, fig.width = p4_width, fig.height = p4_height}
plot_fn = function(j) {
  plot_tseries(est = post_summ(post, sub_index("^G[year,origin,pop]", pop = j, year = ts_yrs, origin = o_hor)), yrs = all_yrs[ts_yrs], label_text = pops[j])
}

mypar()
junk = sapply(1:jags_data$nj, plot_fn)
axis_labels("Return Year", "Number of Strays Entering Population")
```

### Stray Composition

```{r stray-comp, fig.width = p4_width, fig.height = p4_height}
plot_fn = function(j) {
  x = post_summ(post, sub_index("p_G[age,origin,pop]", age = ".", origin = o_hor, pop = j))
  
  mp = barplot(x["mean",], ylim = ylim_01, xaxt = "n", col = tran_cols["model"], border = main_cols["model"])
  segments(mp, x["2.5%",], mp, x["97.5%",], col = alpha("red", 0.5))
  axis(side = 1, at = mp, labels = paste0("Age", jags_data$kmin:jags_data$kmax), las = 1)
  segments(par("usr")[1], par("usr")[3], par("usr")[2], par("usr")[3], xpd = TRUE, col = par("col.axis"))
  segments(par("usr")[1], par("usr")[3], par("usr")[1], par("usr")[4], xpd = TRUE, col = par("col.axis"))
  panel_label(pops[j])
}

mypar()
junk = sapply(1:jags_data$nj, plot_fn)
axis_labels("Age of Return", "Proportion of Strays by Age")
```
